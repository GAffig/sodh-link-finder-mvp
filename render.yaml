services:
  - type: web
    name: population-health-evidence-portal
    runtime: node
    buildCommand: npm install --no-audit --no-fund
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: BRAVE_API_KEY
        sync: false
      - key: SERPAPI_KEY
        sync: false
      - key: BING_API_KEY
        sync: false
      - key: SEARCH_COST_MODE
        value: economy
      - key: SEARCH_MAX_PROVIDER_CALLS
        value: 4
      - key: SEARCH_STANDARD_MAX_PROVIDER_CALLS
        value: 8
      - key: SEARCH_AUTO_ESCALATE_STANDARD
        value: true
      - key: SEARCH_ESCALATE_MIN_RESULTS
        value: 8
      - key: SEARCH_ESCALATE_MIN_PRIORITY_RESULTS
        value: 3
      - key: SEARCH_ESCALATE_MIN_DISTINCT_DOMAINS
        value: 3
      - key: SEARCH_CACHE_BACKEND
        value: auto
      - key: SEARCH_CACHE_NAMESPACE
        value: sodh:search-cache:v1
      - key: SEARCH_CACHE_TTL_MS
        value: 604800000
      - key: SEARCH_CACHE_MAX_ENTRIES
        value: 200
